{% load static %}
<div class="col-md-3 col-lg-3 d-none d-lg-block sticky-sidebar">
  <div class="search-container bg-white rounded-5 p-2 shadow-sm d-flex align-items-center">
    <div class="ps-2 cursor-pointer"
         hx-get="{% url 'core:search' %}"
         hx-target="#main-content-area"
         hx-include="[name='q']"
         hx-push-url="true">
        <img src="{% static 'assets/search-24-outlined.svg' %}" alt="search" width="20">
    </div>

    <div class="position-relative flex-grow-1">
        <input
            id="search-input"
            class="form-control-search ps-2 pe-4"
            type="text"
            name="q"
            placeholder="Search..."
            hx-get="{% url 'core:search' %}"
            hx-target="#main-content-area"
            hx-trigger="keyup changed delay:500ms, search"
            hx-push-url="true"
            value="{{ query|default:'' }}"
            autocomplete="off"
        >

        <button id="clear-search"
                type="button"
                class="btn-close position-absolute end-0 top-50 translate-middle-y me-2"
                style="font-size: 0.7rem; display: none;"
                onclick="clearSearchInput()">
        </button>
    </div>
  </div>

  <div class="bg-white rounded-5 p-3 mt-3 shadow-sm">
    <h3 class="h5 fw-bold">People to Follow</h3>
    {% for user in suggested_users %}
      <div class="d-flex align-items-center justify-content-between pt-2">
        <a href="{% url 'user:profile_detail' user.username %}"
           hx-get="{% url 'user:profile_detail' user.username %}"
           hx-target="#main-content-area"
           hx-push-url="true"
           class="d-flex align-items-center gap-2 text-decoration-none text-black">
          <img src="{% if user.profile.profile_pic %}{{ user.profile.profile_pic.url }}{% else %}{% static 'assets/Group 8.png' %}{% endif %}"
               class="rounded-circle" width="35" height="35" style="object-fit: cover;">
          <p class="mb-0 small fw-bold">{{ user.username }}</p>
        </a>
        <button class="btn btn-outline-primary btn-sm rounded-pill"
                hx-post="{% url 'user:follow_user' user.username %}"
                hx-target="this"
                hx-swap="outerHTML">
          Follow
        </button>
      </div>
    {% endfor %}
  </div>

  <div class="bg-white rounded-5 p-3 mt-3 shadow-sm">
    <h3 class="h5 fw-bold">Groups</h3>
    {% for group in suggested_groups %}
      <div class="d-flex align-items-center justify-content-between pt-2">
        <a href="{% url 'group:group_list' %}"
           hx-get="{% url 'group:group_list' %}"
           hx-target="#main-content-area"
           hx-push-url="true"
           class="d-flex align-items-center gap-2 text-decoration-none text-black">
          <div class="bg-light rounded-circle p-1">
             <img src="{% static 'assets/users-24-outlined.svg' %}" width="20" alt="">
          </div>
          <p class="mb-0 small fw-bold">{{ group.name }}</p>
        </a>
        <button class="btn btn-outline-success btn-sm rounded-pill px-3"
                hx-post="{% url 'group:group_toggle' group.id %}"
                hx-target="this"
                hx-swap="outerHTML">
          Join
        </button>
      </div>
    {% endfor %}
  </div>
</div>

<script>
    function clearSearchInput() {
        const input = document.getElementById('search-input');
        const clearBtn = document.getElementById('clear-search');
        input.value = '';
        clearBtn.style.display = 'none';

        input.dispatchEvent(new Event('search'));
    }

    document.getElementById('search-input').addEventListener('input', function(e) {
        const clearBtn = document.getElementById('clear-search');
        clearBtn.style.display = e.target.value.length > 0 ? 'block' : 'none';
    });

    window.addEventListener('load', () => {
        const input = document.getElementById('search-input');
        if(input && input.value.length > 0) {
            document.getElementById('clear-search').style.display = 'block';
        }
    });
</script>
